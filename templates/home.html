{% extends "base.html" %}
{% load static %}
{% block title %}
    | Home
{% endblock title %}

{% block body %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<div class="hero-section">
    <div class="hero-overlay">
        <div class="hero-content text-center">
            <h1>Discover the Smartest Way to Navigate</h1>
            <p>Explore the City of Lights with confidence. Choose the most efficient and reliable routes tailored to your journey.</p>
        </div>
    </div>
</div>

<div class="route-finder-section">
    <h2>Route Finder</h2>
    <form method="post" action="/find_route" class="route-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="fromStation">From</label>
            <input type="text" id="fromStation" name="fromStation" placeholder="Type to search station/location" autocomplete="off">
            <ul id="fromSuggestions" class="suggestions-list"></ul>
        </div>

        <div class="form-group">
            <label for="toStation">To</label>
            <input type="text" id="toStation" name="toStation" placeholder="Type to search station/location" autocomplete="off">
            <ul id="toSuggestions" class="suggestions-list"></ul>
        </div>

        <button type="button" class="btn-primary" onclick="this.closest('form').submit()">Find Route</button>
        <p>*See the map first to select the correct stations according to your joruney. </p> <a href="map">Click here to view the map</a>
    </form>
</div>


<script>
function setupAutocomplete(inputId, suggestionId) {
    const input = document.getElementById(inputId);
    const suggestions = document.getElementById(suggestionId);

    input.addEventListener("input", async () => {
        const query = input.value.trim();
        if (!query) {
            suggestions.innerHTML = "";
            return;
        }

        try {
            const response = await fetch(`/stations/?q=${encodeURIComponent(query)}`);
            const stations = await response.json();

            suggestions.innerHTML = "";

            if (stations.length === 0) {
                suggestions.innerHTML = `<li class="no-suggestion">No stations found</li>`;
                return;
            }

            stations.forEach(station => {
                const li = document.createElement("li");
                li.textContent = station;
                li.className = "suggestion-item";
                li.addEventListener("click", () => {
                    input.value = station;
                    suggestions.innerHTML = "";
                });
                suggestions.appendChild(li);
            });
        } catch (error) {
            console.error("Autocomplete error:", error);
        }
    });
}

setupAutocomplete("fromStation", "fromSuggestions");
setupAutocomplete("toStation", "toSuggestions");
</script>

{% endblock body %}
